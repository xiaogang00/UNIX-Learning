精灵进程（ daemon）是生存期长的一种进程。它们常常在系统引导装入时起动，在系统关闭时终止。因为它们没有控制终端，所以说它们是在后台运行的。 U N I X系统有很多精灵进程，它们执行日常事物活动

ps(1)命令打印系统中各个进程的状态。该命令有多个选择项，如：

```
ps -axj
```

选择项- a显示由其他用户所拥有的进程的状态。 - x显示没有控制终端的进程的状态。 - j显示与作业有关的信息：对话期 I D、进程组I D、控制终端以及终端进程组 I D。

注意，所有精灵进程都以超级用户（用户 I D为0）的优先权运行。没有一个精灵进程具有控制终端—终端名称设置为问号(?)、终端前台进程组I D设置为－ 1。缺少控制终端可能是精灵进程调用了setsid的结果。

#### 编程规则

在编写精灵进程程序时需遵循一些基本规则，以便防止产生并不希望的交互作用。下面先
说明这些规则，

1. 首先做的是调用fork，然后使父进程exit。这样做实现了下面几点：第一，如果该精灵进程是由一条简单shell命令起动的，那么使父进程终止使得shell认为这条命令已经执行完成。第二，子进程继承了父进程的进程组 I D，但具有一个新的进程I D，这就保证了子进程不是一个进程组的首进程。这对于下面就要做的 setsid调用是必要的前提条件。
2.  调用setsid以创建一个新对话期。
3. 将当前工作目录更改为根目录。从父进程继承过来的当前工作目录可能在一个装配的文件系统中。
4. 将文件方式创建屏蔽字设置为0。由继承得来的文件方式创建屏蔽字可能会拒绝设置某些许可权。
5. 关闭不再需要的文件描述符。这样使精灵进程就不再持有从其父进程继承来的某些文件描述符。

#### 出错记录

与精灵进程有关的一个问题是如何处理出错消息。因为它没有控制终端，所以不能只是写到标准出错输出上。所以，需要有一个集中的精灵进程出错记录设施。

**三种产生记录消息的方法**：

1.  内核中的例程可以调用 strlog以产生记录消息。这种方法通常由流模块和流设备驱动程序用于出错消息或跟踪消息（跟踪消息常用在新的流模块或驱动程序的排错中）。因为我们无意编写内核中的例程，所以不详细说明这种消息产生方法。
2.  一个用户进程（例如一个精灵进程）可以用 putmsg将消息送到/dev/log。这种消息可被送到三个记录进程中的任意一个。
3.  一个用户进程（例如一个精灵进程）可以用 write将消息写到/dev/conslog。这种消息只能送向控制台记录进程。

**三种读记录消息的方法**：

1. 标准的出错记录进程是strerr。它将记录消息增写到在目录/var/adm/stream下的一个文件中。该文件名是 error.mm-dd，其中，mm是月份，dd是天数。strerr本身是个精灵进程，通常在后台运行,它将记录消息增写到该文件中。
2. 标准的跟踪记录进程是strace。它能有选择地将一套指定的跟踪消息写至其标准输出。
3. 标准控制台记录进程是 syslogd，这是一个BSD导出程序，下一节将对此进行叙述。此进程是个精灵进程，它读一个配置文件，然后将记录消息写至一个指定的文件（控制台是一个文件）或登录用户，或将该消息发送给在另一台主机上的 syslog精灵进程。

